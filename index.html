<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã‚½ãƒ•ãƒˆãƒœãƒ¼ãƒ«å¤§ä¼š ã‚¹ã‚³ã‚¢ãƒœãƒ¼ãƒ‰</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Hiragino Kaku Gothic Pro', 'ãƒ¡ã‚¤ãƒªã‚ª', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }
        
        .container { max-width: 1200px; margin: 0 auto; }
        
        header {
            text-align: center;
            color: white;
            margin-bottom: 20px;
        }
        
        h1 {
            font-size: 2.2em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        /* ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒãƒ¼ï¼ˆæ›´æ–°ãƒœã‚¿ãƒ³å‘¨ã‚Šï¼‰ */
        .status-bar {
            background: rgba(255,255,255,0.2);
            padding: 8px 20px;
            border-radius: 20px;
            display: inline-flex;
            align-items: center;
            gap: 15px;
            backdrop-filter: blur(5px);
            margin-bottom: 20px;
        }
        
        .update-time { font-size: 0.9em; color: white; }
        
        .refresh-btn {
            background: white;
            border: none;
            color: #667eea;
            padding: 6px 15px;
            border-radius: 15px;
            cursor: pointer;
            font-weight: bold;
            transition: transform 0.2s;
        }
        .refresh-btn:active { transform: scale(0.95); }
        .refresh-btn:disabled { opacity: 0.7; cursor: wait; }

        /* ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ */
        .nav { text-align: center; margin-bottom: 30px; }
        .nav-link {
            display: inline-block;
            padding: 12px 30px;
            background: white;
            color: #667eea;
            text-decoration: none;
            border-radius: 25px;
            font-weight: bold;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            transition: transform 0.2s;
        }
        .nav-link:hover { transform: translateY(-2px); }
        
        /* ã‚³ãƒ¼ãƒˆè¡¨ç¤ºã‚¨ãƒªã‚¢ */
        .courts {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(450px, 1fr));
            gap: 30px;
        }
        
        .court {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            border-top: 5px solid #667eea;
        }
        
        .court-header {
            text-align: center;
            font-size: 1.5em;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }
        
        .game {
            margin-bottom: 25px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 10px;
        }
        
        .game-title {
            font-size: 1.1em;
            font-weight: bold;
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .status {
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 0.8em;
            color: white;
        }
        .status.playing { background: #ff6b6b; animation: pulse 2s infinite; }
        .status.waiting { background: #95a5a6; }
        .status.finished { background: #2ecc71; }
        
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.7; } 100% { opacity: 1; } }

        .scoreboard { overflow-x: auto; }
        
        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 300px;
        }
        
        th, td {
            padding: 8px 4px;
            text-align: center;
            border: 1px solid #ddd;
            font-size: 0.95em;
        }
        
        th { background: #667eea; color: white; font-weight: normal; }
        td { background: white; }
        
        .team-name {
            text-align: left;
            font-weight: bold;
            min-width: 100px;
            padding-left: 8px;
        }
        
        .score-cell { font-family: monospace; font-size: 1.1em; }
        .score-zero { color: #ccc; } /* 0ç‚¹ã¯è–„ãè¡¨ç¤º */
        
        .total {
            background: #fff3cd !important;
            font-weight: bold;
            color: #856404;
        }
        
        .loading, .no-games {
            text-align: center;
            padding: 40px;
            color: white;
            font-size: 1.2em;
            grid-column: 1 / -1;
        }
        
        @media (max-width: 768px) {
            h1 { font-size: 1.6em; }
            .courts { grid-template-columns: 1fr; }
            .court { padding: 15px; }
            th, td { font-size: 0.85em; padding: 6px 2px; }
            .team-name { min-width: 80px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>âš¾ ã‚½ãƒ•ãƒˆãƒœãƒ¼ãƒ«å¤§ä¼š</h1>
            
            <div class="status-bar">
                <span class="update-time" id="updateTime">æœªæ›´æ–°</span>
                <button class="refresh-btn" id="refreshBtn" onclick="fetchScores()">ğŸ”„ æ›´æ–°</button>
            </div>
        </header>
        
        <div class="nav">
            <a href="photos.html" class="nav-link">ğŸ“¸ å†™çœŸã‚®ãƒ£ãƒ©ãƒªãƒ¼ã¸</a>
        </div>
        
        <div class="courts" id="courts">
            <div class="loading">ã‚¹ã‚³ã‚¢ã‚’èª­ã¿è¾¼ã‚“ã§ã„ã¾ã™...</div>
        </div>
    </div>

    <script>
        // â˜…â˜…â˜… æ³¨æ„ â˜…â˜…â˜…
        // ã“ã“ã«ã¯ã€Œã‚¹ã‚¿ãƒƒãƒ•ç”¨Botï¼ˆå¾—ç‚¹å…¥åŠ›Botï¼‰ã€ã®Webã‚¢ãƒ—ãƒªURLã‚’è¨­å®šã—ã¦ãã ã•ã„
        const API_URL = 'https://script.google.com/macros/s/AKfycby17_LC3yqT-_t16_nBkoXyZ7ZL8ku1cD__kCP5oF3VhVUaN3khClsffH70IaMt058/exec';
        
        // ãƒ‡ãƒ¼ã‚¿å–å¾—
        async function fetchScores() {
            const btn = document.getElementById('refreshBtn');
            const timeLabel = document.getElementById('updateTime');
            const courtsDiv = document.getElementById('courts');
            
            // ãƒœã‚¿ãƒ³é€£æ‰“é˜²æ­¢
            btn.disabled = true;
            btn.textContent = 'é€šä¿¡ä¸­...';
            
            try {
                // ã‚­ãƒ£ãƒƒã‚·ãƒ¥å›é¿ã®ãŸã‚ã«ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—(?t=...)ã‚’ä»˜ä¸
                const response = await fetch(`${API_URL}?t=${new Date().getTime()}`);
                const data = await response.json();
                
                displayScores(data);
                
                timeLabel.textContent = `æœ€çµ‚æ›´æ–°: ${data.lastUpdate}`;
            } catch (error) {
                console.error('ãƒ‡ãƒ¼ã‚¿å–å¾—ã‚¨ãƒ©ãƒ¼:', error);
                // æ—¢ã«è¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹å ´åˆã¯ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å‡ºã•ãšã€æ™‚åˆ»ã ã‘æ›´æ–°
                if (courtsDiv.children.length === 0 || courtsDiv.querySelector('.loading')) {
                    courtsDiv.innerHTML = '<div class="no-games">ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ<br>å†èª­ã¿è¾¼ã¿ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ãã ã•ã„</div>';
                }
                timeLabel.textContent = 'æ›´æ–°å¤±æ•—';
            } finally {
                // ãƒœã‚¿ãƒ³å¾©å¸°
                btn.disabled = false;
                btn.textContent = 'ğŸ”„ æ›´æ–°';
            }
        }
        
        // ã‚¹ã‚³ã‚¢è¡¨ç¤ºãƒ­ã‚¸ãƒƒã‚¯
        function displayScores(data) {
            const courtsDiv = document.getElementById('courts');
            
            if (!data.games || data.games.length === 0) {
                courtsDiv.innerHTML = '<div class="no-games">ç¾åœ¨ã€è©¦åˆãƒ‡ãƒ¼ã‚¿ã¯ã‚ã‚Šã¾ã›ã‚“</div>';
                return;
            }
            
            // ã‚³ãƒ¼ãƒˆã”ã¨ã«ã‚°ãƒ«ãƒ¼ãƒ—åŒ–
            const courtGroups = {};
            data.games.forEach(game => {
                if (!courtGroups[game.court]) courtGroups[game.court] = {};
                if (!courtGroups[game.court][game.gameNum]) courtGroups[game.court][game.gameNum] = [];
                courtGroups[game.court][game.gameNum].push(game);
            });
            
            let html = '';
            // ã‚³ãƒ¼ãƒˆé †åºã‚’å›ºå®š (A -> B)
            ['A', 'B', 'C', 'D'].forEach(court => {
                if (!courtGroups[court]) return;
                
                html += `<div class="court">
                    <div class="court-header">${court}ã‚³ãƒ¼ãƒˆ</div>`;
                
                const games = courtGroups[court];
                // ç¬¬1è©¦åˆã€ç¬¬2è©¦åˆ...ã®é †ã«ã‚½ãƒ¼ãƒˆ
                Object.keys(games).sort((a, b) => a - b).forEach(gameNum => {
                    const teams = games[gameNum];
                    // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹åˆ¤å®šï¼ˆãƒãƒ¼ãƒ ã®èª°ã‹ãŒè©¦åˆä¸­ãªã‚‰è©¦åˆä¸­ï¼‰
                    const rawStatus = teams[0].status || 'è©¦åˆå‰';
                    let statusClass = 'waiting';
                    let statusLabel = rawStatus;
                    
                    if (rawStatus === 'è©¦åˆä¸­') {
                        statusClass = 'playing';
                        statusLabel = 'ğŸ”¥ è©¦åˆä¸­';
                    } else if (rawStatus === 'çµ‚äº†') {
                        statusClass = 'finished';
                    }
                    
                    html += `
                        <div class="game">
                            <div class="game-title">
                                <span>ç¬¬${gameNum}è©¦åˆ</span>
                                <span class="status ${statusClass}">${statusLabel}</span>
                            </div>
                            <div class="scoreboard">
                                <table>
                                    <thead>
                                        <tr>
                                            <th style="width:35%">ãƒãƒ¼ãƒ </th>
                                            <th>1</th><th>2</th><th>3</th><th>4</th><th>5</th><th>6</th><th>7</th>
                                            <th style="width:10%">R</th>
                                        </tr>
                                    </thead>
                                    <tbody>`;
                    
                    teams.forEach(team => {
                        html += `<tr>
                            <td class="team-name">${team.team}</td>`;
                        
                        // 1å›ã€œ7å›
                        for (let i = 0; i < 7; i++) {
                            const score = team.innings[i];
                            // 0ç‚¹ãªã‚‰è–„ãã€ãã‚Œä»¥å¤–ã¯æ¿ƒãã€ãƒ‡ãƒ¼ã‚¿ãªã—(undefined)ã¯ç©ºæ¬„
                            const displayScore = (score === '' || score === undefined) ? '' : score;
                            const zeroClass = (score === 0 || score === '0') ? 'score-zero' : '';
                            
                            html += `<td class="score-cell ${zeroClass}">${displayScore}</td>`;
                        }
                        
                        html += `<td class="total">${team.total || 0}</td>
                            </tr>`;
                    });
                    
                    html += `</tbody></table></div></div>`;
                });
                html += '</div>';
            });
            
            courtsDiv.innerHTML = html;
        }
        
        // åˆå›èª­ã¿è¾¼ã¿
        fetchScores();
        
        // è‡ªå‹•æ›´æ–° (60ç§’é–“éš”ã«å¤‰æ›´ã—ã¦ã‚µãƒ¼ãƒãƒ¼è² è·ã‚’è»½æ¸›)
        setInterval(fetchScores, 60000);
    </script>
</body>
</html>
